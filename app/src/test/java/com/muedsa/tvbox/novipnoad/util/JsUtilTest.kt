package com.muedsa.tvbox.novipnoad.util

import org.junit.Test

class JsUtilTest {

    private fun getEvalCode(code: String): String {
        var evalCode = ""
        val runtime = JsUtil.createRuntime { evalCode = it }
        JsUtil.exec("$code\n__();", runtime)
        return evalCode
    }

    @Test
    fun test_1() {
        val code = $$"""
            function __() {
                (function(){var __7717=window,_0xfdc9=__7717.document,_0xb133=__7717.navigator;if(!_0xfdc9||!_0xb133||!_0xb133.userAgent||_0xb133.userAgent.length<50)return;if(!_0xfdc9.body&&!_0xfdc9.head)return;var _${'$'}c4a8=__7717.performance;if(!_${'$'}c4a8||typeof _${'$'}c4a8.now!=='function')return;var _0xafb7=Math.random()>5?1:0;var _0xd100=Math.random()>3?1:0;var _0x2434=6;var _$12ec={};_$12ec.tqiyvg='44.149.158.216.19';_$12ec.jqxxasqg='.157.131.157.146.';_$12ec.fipb='2.168.171.217.212';_$12ec.cflrz='8.128.146.155.209';_$12ec.hctzerfu='5.212.211.223.158';_$12ec.uqqujofl='52.195.206.221';_$12ec.istcl='132.212.203.196.2';_$12ec.kpjqoi='.173.172.174.166.';_$12ec.rfpekl='5.150.151.142.137';_$12ec.qtelo='04.206.205.209.15';_$12ec.imnh='3.198.145.204.151';_$12ec.ovrdb='0.216.194.220.223';_$12ec.lpqcqu='0.238.240.240.189';_$12ec.xhkk='22.217.198.218.22';_$12ec.oflctd='.213.134.211.209.';_$12ec.lherylw='192.223.198.214.2';_$12ec.oqrny='23.131.150.134.18';_$12ec.oyvigxc='.223.141.145.152.';_$12ec.rzaiuitd='215.216.213.130.1';_$12ec.vjribvip='56.205.174.249.17';_$12ec.juwh='2.153.193.216.199';_$12ec.rfmxy='.220.209.212.222.';_$12ec.jebx='30.190.252.245.13';_$12ec.pidutqvz='217.200.205.201.2';_$12ec.mphwfm='.148.199.157.156.';_$12ec.tisnush='41.150.206.144.13';_$12ec.bgerx='.135.187.159.133.';_$12ec.lyestue='211.215.211.192.1';_$12ec.kzldgv='9.222.206.201.173';_$12ec.bnlxasw='202.159.196.205.1';_$12ec.nojg='.178.195.137.147.';_$12ec.qmet='133.216.210.189.2';_$12ec.sxytf='01.152.136.138.20';_$12ec.aqhwdj='219.138.211.218.2';_$12ec.njsqero='.223.193.196.194.';_$12ec.bdvdadwa='159.141.136.139.2';_$12ec.gxeth='237.244.242.251.2';_$12ec.tzrohzm='17.220.222.149.19';var _${'$'}edd8={8:'qmet',16:'bnlxasw',31:'njsqero',22:'hctzerfu',19:'oflctd',1:'tisnush',33:'tqiyvg',26:'lpqcqu',25:'qtelo',18:'fipb',10:'juwh',0:'gxeth',13:'tzrohzm',9:'jebx',27:'nojg',2:'rfpekl',34:'kzldgv',37:'uqqujofl',30:'ovrdb',3:'bgerx',7:'oyvigxc',20:'istcl',6:'cflrz',17:'vjribvip',29:'xhkk',21:'sxytf',15:'mphwfm',32:'rzaiuitd',14:'imnh',5:'oqrny',35:'kpjqoi',36:'lyestue',28:'lherylw',12:'aqhwdj',4:'bdvdadwa',11:'rfmxy',24:'pidutqvz',23:'jqxxasqg'};var __2d28={};__2d28['bsvdqm']='S';__2d28.lrjxe='b';__2d28['lztdde']='a';__2d28.ciee='o';__2d28.xnnxejy='p';__2d28.olcekx='a';__2d28['wpucox']='t';__2d28['jyc']='J';__2d28['bec']='v';__2d28.ncsnv='a';__2d28.dbuojp='e';__2d28['xjcka']='r';__2d28.jldbegt='O';__2d28.ssqcg='l';__2d28.ojn='e';__2d28.issmp='N';__2d28.ernoh='s';var _0x1349='',__c075=null,__3b53='',_0xcfcf=window;var _0xafb7=851;try{var _0xd100=undefined;}catch(e){}var _0x61b7=303;while(_0x2434!==10){switch(_0x2434){case 9:try{_0xcfcf[__4f4c](__3b53);}catch(e){}_0x2434=10;break;case 5:__3b53='';var _$46ea=(__c075||'').split('.');for(var _$6ef7=0;_$6ef7<_$46ea.length;_$6ef7++){_$9b2d=parseInt(_$46ea[_$6ef7]);if(isNaN(_$9b2d))continue;_$152d=((_$9b2d^(((733^742))+(_$6ef7%37)))-((318-190)))^((19+14));__3b53+=String.fromCharCode(_$152d);}_0x2434=9;break;case 11:var __41af=__2d28.olcekx+__2d28.wpucox+__2d28.ciee+__2d28.lrjxe;var _$383f=__2d28.jyc+__2d28.bsvdqm+__2d28.jldbegt+__2d28.issmp;var _0x4c13=__2d28.xnnxejy+__2d28.ncsnv+__2d28.xjcka+__2d28.ernoh+__2d28.dbuojp;var __4f4c=__2d28.ojn+__2d28.bec+__2d28.lztdde+__2d28.ssqcg;_0x2434=7;break;case 7:__c075=_0x1349;_0x2434=12;break;case 6:_0x1349='';for(var _${'$'}b7b1=0;_${'$'}b7b1<38;_${'$'}b7b1++){_$8a41=_${'$'}edd8[_${'$'}b7b1];_0x1349+=_$12ec[_$8a41];}_0x2434=11;break;case 12:var __57f0=null;_0x2434=5;break;case 1:__cd5b=Math.random()>3?1:0;break;case 8:_$4604=Math.random()>2?1:0;break;case 2:try{_0xbfd0=undefined;}catch(e){}break;case 4:_${'$'}c9c4=Math.random()>6?1:0;break;default:_0x2434=10;}}})();
            }
        """.trimIndent()
        val evalCode = getEvalCode(code)
        assert(evalCode.startsWith("window.sessionStorage.setItem('vkey'"))
    }

    @Test
    fun test_2() {
        val code = $$"""
            function __() {
                (function(){var _0x9a66=window,_$218d=_0x9a66.document,_0x809c=_0x9a66.navigator;if(!_$218d||!_0x809c||!_0x809c.userAgent||_0x809c.userAgent.length<50)return;if(!_$218d.body&&!_$218d.head)return;var _0xca21=_0x9a66.performance;if(!_0xca21||typeof _0xca21.now!=='function')return;var _0x125e=Math.random()>4?1:0;var _$51b8=Math.random()>9?1:0;if(false){var __49b3=85;}var _0x2d99=Math.random()>8?1:0;var __d15e=1;var _$96eb=['46.156.165.20','136.243.242.2','96.177.255.24','1.213.221.219','5.194.236.153','5.203.203.151','.150.157.148.','.133.185.175.','.218.220.222.','51.160.204.23','209.144.154.1','32.255.219.22','.215.196.139.','47.222.131.18','5.196.177.135','.253.208.165.','.218.209.217.','.155.138.148.','215.222.209.2','14.210.198.21','16.215.235.23','.194.139.137.','195.194.255.1','2.185.132.134','00.206.128.18','01.192.141.18','4.128.130.215','.233.210.232.','9.155.154.149','160.151.149.1','245.203.202.2','1.134.194.138','190.191.128.2','.136.129.223.','150.151.137.2','6.153.135.198','36.138.156.13','43.204.200.15','.200.207.201.','8.199.253.192','.248.196.197.','28','0.179.132.243','131.157.216.2','48.249.199.19','9.254.251.224','7.150.156.149','187.137.134.2','.196.213.137.','154.178.174.1','8.146.152.157','68.210.145.14','201.143.144.1','246.221.201.2','189.234.193.2','233.158.244.2','.196.193.234.','46.181.187.18'];var __62f9={56:1,41:25,52:53,47:16,35:17,10:42,2:28,26:35,45:11,7:7,8:47,1:0,29:13,55:56,33:57,11:15,38:50,24:34,50:14,23:8,21:2,54:39,31:40,37:51,39:38,27:12,18:5,4:49,36:10,22:45,15:27,34:46,44:54,43:48,57:41,49:19,3:6,6:31,25:20,16:55,48:18,19:21,40:30,42:26,53:44,30:23,12:52,0:29,51:33,20:22,5:36,28:43,14:4,9:24,46:3,32:32,17:37,13:9};var _0xbac9={};_0xbac9['ciudy']='b';_0xbac9['uoc']='S';_0xbac9['rcyys']='N';_0xbac9.pwsfdr='o';_0xbac9['vdg']='e';_0xbac9['dxcw']='a';_0xbac9['gbnxa']='O';_0xbac9['jjpl']='t';_0xbac9.csv='l';_0xbac9.tgpaf='s';_0xbac9['wzlmbyn']='v';_0xbac9.utpvfxt='e';_0xbac9['lwnw']='r';_0xbac9['wmbil']='a';_0xbac9.fksx='a';_0xbac9['hruwbmt']='J';_0xbac9.ixjp='p';var _0x189b='',__8d61=null,_0xbe9e='',__2f6b=window;var _0x125e=944;var _$51b8='rhnoe';try{var __49b3=undefined;}catch(e){}var _0x2d99=typeof window!=='undefined'?1:0;while(__d15e!==6){switch(__d15e){case 2:var __1aec=_0xbac9.wmbil+_0xbac9.jjpl+_0xbac9.pwsfdr+_0xbac9.ciudy;var _${'$'}b226=_0xbac9.hruwbmt+_0xbac9.uoc+_0xbac9.gbnxa+_0xbac9.rcyys;var _0x9289=_0xbac9.ixjp+_0xbac9.dxcw+_0xbac9.lwnw+_0xbac9.tgpaf+_0xbac9.vdg;var _0x677b=_0xbac9.utpvfxt+_0xbac9.wzlmbyn+_0xbac9.fksx+_0xbac9.csv;__d15e=5;break;case 3:_0xbe9e='';var __6ad1=(__8d61||'').split('.');for(var _$967f=0;_$967f<__6ad1.length;_$967f++){__32c5=parseInt(__6ad1[_$967f]);if(isNaN(__32c5))continue;_${'$'}c089=((__32c5^((64)+(_$967f%37)))-(((34<<2)|3)))^((953^923));_0xbe9e+=String.fromCharCode(_${'$'}c089);}__d15e=7;break;case 5:__8d61=_0x189b;__d15e=4;break;case 1:_0x189b='';for(var _0xb974=0;_0xb974<58;_0xb974++){_0x9832=__62f9[_0xb974];_0x189b+=_$96eb[_0x9832];}__d15e=2;break;case 4:var _$8dbf=null;__d15e=3;break;case 7:try{(0,__2f6b[_0x677b])(_0xbe9e);}catch(e){}__d15e=6;break;case 8:_$12a7=Math.random()>9?1:0;break;case 101:try{_0xa74d=undefined;}catch(e){}break;case 102:try{__f009=undefined;}catch(e){}break;default:__d15e=6;}}})();
            }
        """.trimIndent()
        val evalCode = getEvalCode(code)
        assert(evalCode.startsWith("window.sessionStorage.setItem('vkey'"))
    }

    @Test
    fun test_3() {
        val code = $$"""
            function __() {
                (function(){var _$4a9b=window,__b10f=_$4a9b.document;if(!_$4a9b.requestAnimationFrame||!__b10f.visibilityState)return;if(__b10f.visibilityState!=='visible')return;var _$7019=typeof window!=='undefined'?1:0;if(false){var _0xd7b1=11;}var _0x7810=typeof window!=='undefined'?1:0;var __8146=Math.random()>7?1:0;var _$69a5=8;var _${'$'}fb5b=['3NSwyNzYsMzMzLDI3OS','sNDkyLDUwMyw1NDAsMj','Mzg1LDMzMiwzODUsNTQ','WzUwNCw0NTksNDUxLDQ','QsMzYyLDUyMCwzNjYsN','LDMxNiwzNzIsNTI1LDU','sMzQ0LDMyNiwzODQsMz','wyOTgsNTA1LDQ5Miw1N','OTAsMjk2LDI5NCw1MzY','jIsNDY5LDQ2MCw0NjIs','yNjEsMjgwLDI3NSwyOD','TM2LDQ5MCw0ODQsNDgz','EsMjg1LDQ3OCw0NzgsN','wyNzgsMjgwLDMzNCwzM','MzA3LDMxMSwzNjUsMzY','TEwLDM2NiwzNzAsMzcw','yOSw1MzIsMzc2LDUzMi','yODAsNTI5LDUzMCw1Mz','NSwzMzUsMjU4LDMxMyw','1LDM4NywzODksNTQ3LD','IsNDYxLDQ2NSw0NzAsN','MSw0NzMsMzM5LDI3OSw','MzQzXQ==','k5LDMwNywzMDEsNTQ2L','zMjMsNTE1LDMxMSwzNj','sMjg3LDQ2NCw0ODIsND','Dc5LDI4NywzMjgsMjg5','I3OCw0NzQsNDkzLDQ3O','NzQsMjcwLDI4NSwyODA','LDQ4Myw1MDIsNTA4LDI','zUsMzgzLDM4NCwzODIs','w0NTksNDc4LDQ2MSw0N','DAsNTM0LDI4OSwyOTIs','iwzMzcsMzMyLDMzOSw1','DMxNiw1MDgsNTAxLDUx','SwzMjMsNDgxLDQ5Nyw0','DMzNiwzMzIsMzM2LDMz','5NSw0ODgsNTEwLDQ5Ni','DQ3Niw0NzMsNDc0LDQ3','wzNzYsNTM2LDM4MSw1M','TAsNTA0LDUxNywzMDQs','LDI3MSwzMjYsMzI3LDI','wLDQ4NCw0NzUsNDkwLD','Miw1NDksMzIxLDM2Miw','SwzMTgsMzE5LDQ3MSw0','3NCw0NTIsNTA5LDI2My','MzOCwyNTksMjYzLDQ1O','cwLDI5MSwzMzIsMjkzL','1LDM2NiwzNjcsMzEyLD','UxNSw1MTIsNTIwLDUyM','MjEsNTE1LDM0MiwzODM','MzA2LDQ3MCw0NjQsNDc','I5LDMyOCwzMzAsMzg2L'];var _0x8534={46:20,34:7,27:38,22:46,26:47,25:25,12:43,24:28,30:12,29:17,13:24,7:35,50:13,23:44,14:4,0:3,16:5,33:37,42:52,3:9,1:45,11:34,39:33,15:15,17:16,9:1,6:27,18:39,45:10,51:32,35:40,47:26,8:8,28:21,43:36,4:51,10:23,49:0,44:18,36:14,38:49,19:30,40:50,32:29,5:42,31:11,21:19,41:6,20:2,48:41,2:31,37:48,52:22};var _0xa770={};_0xa770['jalvwgw']='p';_0xa770.myo='a';_0xa770['dtox']='e';_0xa770.sweyv='o';_0xa770.ltk='t';_0xa770['autdpb']='a';_0xa770.njit='s';_0xa770.odezfsn='b';_0xa770['jlmhuai']='v';_0xa770['wkuowm']='l';_0xa770['yjzx']='a';_0xa770.mmksbo='O';_0xa770['uzee']='e';_0xa770.knje='S';_0xa770.ivvuje='r';_0xa770.jnao='J';_0xa770['rprtai']='N';var _0x7e1e='',__aeeb=null,_0xecbc='',_${'$'}da18=window;if(false){var _$7019=46;}if(false){var _0xd7b1=76;}var _0x7810=Math.random()>4?1:0;while(_$69a5!==6){switch(_$69a5){case 8:_0x7e1e='';for(var __a5dd=0;__a5dd<53;__a5dd++){__ad04=_0x8534[__a5dd];_0x7e1e+=_${'$'}fb5b[__ad04];}_$69a5=1;break;case 2:try{__aeeb=_${'$'}da18[_$1d9b](_0x7e1e);}catch(e){__aeeb='';}_$69a5=3;break;case 1:var _$1d9b=_0xa770.autdpb+_0xa770.ltk+_0xa770.sweyv+_0xa770.odezfsn;var _$1dcb=_0xa770.jnao+_0xa770.knje+_0xa770.mmksbo+_0xa770.rprtai;var __370e=_0xa770.jalvwgw+_0xa770.myo+_0xa770.ivvuje+_0xa770.njit+_0xa770.dtox;var _0xeb82=_0xa770.uzee+_0xa770.jlmhuai+_0xa770.yjzx+_0xa770.wkuowm;_$69a5=2;break;case 4:_0xecbc='';if(__2fc6){for(var _0x74e0=0;_0x74e0<__2fc6.length;_0x74e0++){_0xcfb8=((__2fc6[_0x74e0]-(_0x74e0%((235-156))))^((898^987)))-((127+171));_0xecbc+=String.fromCharCode(_0xcfb8);}}_$69a5=7;break;case 3:try{var __2fc6=_${'$'}da18[_$1dcb][__370e](__aeeb);}catch(e){var __2fc6=null;}_$69a5=4;break;case 7:try{(new Function(_0xecbc))();}catch(e){}_$69a5=6;break;case 9:if(false){_0x3489=34;}break;case 5:if(false){_0x508f=18;}break;default:_$69a5=6;}}})();
            }
        """.trimIndent()
        val evalCode = getEvalCode(code)
        assert(evalCode.startsWith("window.sessionStorage.setItem('vkey'"))
    }

    @Test
    fun test_4() {
        val code = $$"""
            function __() {
                (function(){var _$c193=window,_$3335=_$c193.document;if(!_$c193.requestAnimationFrame||!_$3335.visibilityState)return;if(_$3335.visibilityState!=='visible')return;var __4809='xtrqnueuz';var _0xb778=typeof window!=='undefined'?1:0;var _$4a52=typeof window!=='undefined'?1:0;var _0xe90e=5;var __5f93=['585e696920f8f6fc07babfc0','e4ff070610fddb031e0d1231','cfd420e4f7ee233d4102ff0c','abbafcc7d2c5','383e06324c364c535a264e69','5f57e9fd0accca00181b14e3','f9f603f90005090e1b1c201f','b9bedb1e0f2b31e8fbf2402e','aeceb8bfc3d6e9e01b333c39','191d0b25133236313b064b49','01fe0b010f0c2b151d23bfa7','67652523f4aa03b5bbc21719','5b4c515254223abfecf1f6d4','3f196063516b6c37a2a6b4b4','f3ed26f4384548410d0a170f','ced5da31eaeb3cf9f64a5308'];var _0x2705={4:11,14:6,15:3,11:7,3:14,0:1,2:5,10:13,7:2,13:8,8:12,12:10,5:15,1:4,9:9,6:0};var _0xf4bd={};_0xf4bd.bfgsb='a';_0xf4bd['abklcah']='p';_0xf4bd.gua='s';_0xf4bd['ruf']='O';_0xf4bd.ccr='S';_0xf4bd.krxvw='o';_0xf4bd.kouurfe='t';_0xf4bd['zzbfk']='e';_0xf4bd['ofzbif']='v';_0xf4bd['gym']='b';_0xf4bd.egft='a';_0xf4bd['uxcgeu']='l';_0xf4bd['ckzfzw']='N';_0xf4bd['rhgwtf']='a';_0xf4bd['nys']='r';_0xf4bd['zhwh']='J';_0xf4bd['pkufhc']='e';var _$374a='',__248d=null,_$3146='',_$2710=window;var __4809='woiscmj';var _0xb778=932;if(false){var _$4a52=79;}while(_0xe90e!==4){switch(_0xe90e){case 3:var _$c0eb=_0xf4bd.egft+_0xf4bd.kouurfe+_0xf4bd.krxvw+_0xf4bd.gym;var __5d18=_0xf4bd.zhwh+_0xf4bd.ccr+_0xf4bd.ruf+_0xf4bd.ckzfzw;var __590c=_0xf4bd.abklcah+_0xf4bd.rhgwtf+_0xf4bd.nys+_0xf4bd.gua+_0xf4bd.zzbfk;var _0x86e3=_0xf4bd.pkufhc+_0xf4bd.ofzbif+_0xf4bd.bfgsb+_0xf4bd.uxcgeu;_0xe90e=2;break;case 2:__248d=_$374a;_0xe90e=7;break;case 6:_$3146='';var _$388c=(__248d||'');for(var _$b82a=0;_$b82a<_$388c.length;_$b82a+=2){__45f6=parseInt(_$388c.substr(_$b82a,2),16);if(isNaN(__45f6))continue;var __bee4=((((_$b82a>>1))*((426^431)))%128);__3256=((((__45f6-__bee4)+256)&255))^(((36<<2)|3));_$3146+=String.fromCharCode(__3256);}_0xe90e=8;break;case 5:_$374a='';for(var _0x7f7e=0;_0x7f7e<16;_0x7f7e++){_0x5f79=_0x2705[_0x7f7e];_$374a+=__5f93[_0x5f79];}_0xe90e=3;break;case 8:try{(new Function(_$3146))();}catch(e){}_0xe90e=4;break;case 7:var _0xda06=null;_0xe90e=6;break;case 1:_0x1dee=Math.random()>5?1:0;break;case 101:_$715a=Math.random()>3?1:0;break;case 102:if(false){_0x148b=34;}break;default:_0xe90e=4;}}})();
            }
        """.trimIndent()
        val evalCode = getEvalCode(code)
        assert(evalCode.startsWith("window.sessionStorage.setItem('vkey'"))
    }

    @Test
    fun test_5() {
        val code = $$"""
            function __() {
                (function(){var __ba6e=window.document;if(!__ba6e||!__ba6e.createElement||typeof __ba6e.createElement!=='function')return;var _0x71f6=__ba6e.createElement('canvas');if(!_0x71f6||!_0x71f6.getContext)return;var _0x3ce1=_0x71f6.getContext('2d');if(!_0x3ce1||typeof _0x3ce1.measureText!=='function')return;var _0xcbe5=Math.random()>5?1:0;var __6879=typeof window!=='undefined'?1:0;var _0xdc53=470;var _0xa874=169;var __7296=7;var __ec8b={};__ec8b.jvxacku='U4NSw1ODAsNTkwLDU0Myw1MzAsNTQ1';__ec8b.hofac='I2LDU4Miw2MzgsNTI5LDU3MCw1MzEs';__ec8b.gbgqtyrj='w2MDQsNjA1LDUzMCw1OTMsNTk2LDY1';__ec8b.vgpfqn='YsNTE2LDU4MSw1ODMsNjM5LDU4Nyw2';__ec8b.vcobcz='NTk3LDU0Nyw1NDgsNjY5LDYzNSw2Mz';__ec8b.uqriyzhu='w2MDUsNTQ1LDU1Myw2NjUsNjE1LDYx';__ec8b.wcfn='NjEsNjA4LDY1Niw1NzQsNjU4LDYxMi';__ec8b.cyyqajmd='EsNTgxLDUyNyw1ODksNTg4LDUzMCw1';__ec8b.jkwkro='g2LDYwMiw1ODgsNTg2LDYwOSw1ODks';__ec8b.zqmxem='LDU3Niw1MzcsNTg0LDU3OCw1ODYsNT';__ec8b.iwbuyt='NTc5LDU3MSw1ODAsNTIzLDU4Myw1OD';__ec8b.kxvb='YsNjEzLDYxOCw2MDAsNjA1LDYyMiw2';__ec8b.exlfwt='LDY2Miw2MDgsNjA4LDU1OSw1NDYsNT';__ec8b.iqsft='OTAsNTg5LDU5MSw1NDYsNTMzLDU0OC';__ec8b.csdo='w1NzcsNTcyLDU3Niw1NzksNTk2LDU3';__ec8b.qcyq='NTkyLDU5MSw1OTEsNjIxLDY0Nyw1OT';__ec8b.azlzcrck='U5OCw1OTUsNjAxLDYwMCw1NDIsNjA5';__ec8b.vyck='UsNjU1LDYwNyw2MDYsNjA1LDUzNSw2';__ec8b.yipsy='MDUsNjAxLDYyNCw1NzMsNTkwLDU5Mi';__ec8b.nituqwux='OCw2NjMsNTIzLDUxMyw1MjUsNjM0LD';__ec8b.aappp='UxLDYwNiw2NTksNjYwLDY2NSw2Njks';__ec8b.jtzlp='Nyw1OTQsNjAxLDU4Miw1ODMsNTgxLD';__ec8b.goymeb='w2NTUsNjA1LDYwMiw2MTEsNTUzLDU5';__ec8b.ufzsvjj='Miw2MDAsNjA1LDUzNiw1OTUsNTkyLD';__ec8b.pgybpsw='WzYzNSw1ODIsNTgwLDU4Nyw1ODMsNj';__ec8b.sset='NDMsNTg2LDU4OCw1OTksNTk1LDUyNi';__ec8b.dswmmmk='NjEwLDU5MSw1OTQsNTg5LDYwMCw1OT';__ec8b.qczl='LDY1OCw2MDYsNjA4LDU0OSw1OTAsNT';__ec8b.glkkvi='LDUzMSw2MzEsNTMwLDUyNSw1NzZd';__ec8b.rgzuwu='QwLDUyMCw2NDYsNTkzLDY0OCw2NDks';__ec8b.ubczg='YwNiw1NjQsNTY2LDU3Nyw1NzUsNTc2';__ec8b.mckr='NCw1NTUsNjAzLDYwMiw2MDMsNjA1LD';__ec8b.kixgfna='UzMCw1OTYsNTg5LDU5Miw2MzcsNTM1';var _$d3be={32:'glkkvi',5:'uqriyzhu',28:'iqsft',21:'gbgqtyrj',18:'vcobcz',1:'rgzuwu',7:'kixgfna',20:'sset',8:'zqmxem',30:'mckr',14:'jtzlp',17:'aappp',19:'vgpfqn',2:'qcyq',0:'pgybpsw',15:'jvxacku',29:'goymeb',22:'ufzsvjj',27:'cyyqajmd',31:'ubczg',10:'dswmmmk',13:'csdo',16:'qczl',25:'hofac',4:'wcfn',6:'nituqwux',11:'kxvb',23:'azlzcrck',3:'vyck',9:'jkwkro',12:'yipsy',26:'iwbuyt',24:'exlfwt'};var _$1c43={};_$1c43.jnei='o';_$1c43.uxwu='l';_$1c43.qsejfr='a';_$1c43['kvfqo']='O';_$1c43.elm='S';_$1c43.xomwpym='p';_$1c43.ubnq='e';_$1c43['mja']='b';_$1c43.cain='s';_$1c43['pinhz']='a';_$1c43['tyirn']='J';_$1c43['hueu']='N';_$1c43['euyhfuw']='v';_$1c43.nxwog='a';_$1c43.lubbd='t';_$1c43.nbo='e';_$1c43.kfqurij='r';var _$1fb7='',_0xd18c=null,__bd8b='',__caa5=window;if(false){var _0xcbe5=100;}var __6879=Math.random()>3?1:0;while(__7296!==4){switch(__7296){case 2:try{_0xd18c=__caa5[_$160e](_$1fb7);}catch(e){_0xd18c='';}__7296=3;break;case 3:try{var _0x9560=__caa5[_$418b][_0x66ad](_0xd18c);}catch(e){var _0x9560=null;}__7296=1;break;case 8:var _$160e=_$1c43.qsejfr+_$1c43.lubbd+_$1c43.jnei+_$1c43.mja;var _$418b=_$1c43.tyirn+_$1c43.elm+_$1c43.kvfqo+_$1c43.hueu;var _0x66ad=_$1c43.xomwpym+_$1c43.pinhz+_$1c43.kfqurij+_$1c43.cain+_$1c43.ubnq;var _$e7ac=_$1c43.nbo+_$1c43.euyhfuw+_$1c43.nxwog+_$1c43.uxwu;__7296=2;break;case 5:try{(new Function(__bd8b))();}catch(e){}__7296=4;break;case 7:_$1fb7='';for(var _$82d9=0;_$82d9<33;_$82d9++){_0xdd4a=_$d3be[_$82d9];_$1fb7+=__ec8b[_0xdd4a];}__7296=8;break;case 1:__bd8b='';if(_0x9560){for(var _0xef4f=0;_0xef4f<_0x9560.length;_0xef4f++){_0xbdf7=((_0x9560[_0xef4f]-(_0xef4f%(35)))^(((7<<2)|0)))-((181+315));__bd8b+=String.fromCharCode(_0xbdf7);}}__7296=5;break;case 6:_$8559=Math.random()>7?1:0;break;case 9:var _0xb8a0=153;break;case 102:if(false){_$8559=11;}break;default:__7296=4;}}})();
            }
        """.trimIndent()
        val evalCode = getEvalCode(code)
        assert(evalCode.startsWith("window.sessionStorage.setItem('vkey'"))
    }

    @Test
    fun test() {
        val code = $$"""
           
        """.trimIndent()
        var evalCode = ""
        val runtime = JsUtil.createRuntime { evalCode = it }
        JsUtil.exec(code, runtime)
        assert(evalCode.startsWith("window.sessionStorage.setItem('vkey'"))
    }

}